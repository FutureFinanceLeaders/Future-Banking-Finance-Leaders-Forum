<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Dashboard | Future Finance Leaders</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
body {
  margin: 0;
  font-family: 'Inter', sans-serif;
  background: #0f172a;
  color: #fff;
}

header {
  background: linear-gradient(90deg, #0f172a, #064e3b);
  padding: 20px 40px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.logo {
  font-weight: 700;
  font-size: 20px;
  color: gold;
}

.logout-btn {
  background: #10b981;
  border: none;
  padding: 10px 18px;
  color: white;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 600;
}

.container {
  padding: 40px;
  max-width: 1200px;
  margin: auto;
}

.welcome {
  font-size: 28px;
  margin-bottom: 30px;
}

.grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
  gap: 20px;
}

.card {
  background: #1e293b;
  padding: 25px;
  border-radius: 16px;
  box-shadow: 0 8px 20px rgba(0,0,0,0.4);
}

.card h3 {
  margin-top: 0;
  color: gold;
}

.badge {
  padding: 6px 12px;
  border-radius: 20px;
  font-size: 12px;
  display: inline-block;
  margin-top: 10px;
}

.free { background: #334155; }
.premium { background: #10b981; }

.section-title {
  margin-top: 50px;
  margin-bottom: 20px;
  font-size: 22px;
  color: #10b981;
}

.notification {
  background: #0f172a;
  padding: 12px;
  border-radius: 8px;
  margin-bottom: 10px;
  font-size: 14px;
}

a.dashboard-link {
  display: inline-block;
  margin-top: 10px;
  color: #10b981;
  text-decoration: none;
  font-weight: 600;
}
</style>
</head>

<body>

<header>
  <div class="logo">Future Finance Leaders (FFL)</div>
  <button class="logout-btn" onclick="logout()">Logout</button>
</header>

<div class="container">

  <div class="welcome" id="welcomeText">Loading...</div>

  <div class="grid">

    <div class="card">
      <h3>Membership</h3>
      <div id="membershipLevel">Loading...</div>
      <div id="membershipBadge"></div>
      <a href="join.html" class="dashboard-link">Upgrade Membership</a>
    </div>

    <div class="card">
      <h3>Profile</h3>
      <p><strong>Name:</strong> <span id="profileName"></span></p>
      <p><strong>Email:</strong> <span id="profileEmail"></span></p>
      <p><strong>Background:</strong> <span id="profileBackground"></span></p>
      <p><strong>LinkedIn:</strong> <span id="profileLinkedin"></span></p>
    </div>

    <div class="card">
      <h3>Activity</h3>
      <p><strong>Events Attended:</strong> <span id="eventsCount">0</span></p>
      <p><strong>Downloads:</strong> <span id="downloadsCount">0</span></p>
      <a href="learning.html" class="dashboard-link">Go to Learning Hub</a>
    </div>

    <div class="card">
      <h3>Referral</h3>
      <p><strong>Your Code:</strong> <span id="referralCode"></span></p>
      <a href="#" class="dashboard-link">Invite Members</a>
    </div>

  </div>

  <div class="section-title">Notifications</div>
  <div id="notificationsContainer"></div>

</div>

<!-- Firebase & Auth -->
<script type="module">

import { auth, db, ref, onValue } from "./firebase.js";
import { onAuthStateChanged } from "./firebase.js";

onAuthStateChanged(auth, (user) => {
  if (!user) {
    window.location.href = "login.html";
    return;
  }

  const uid = user.uid;

  // Load profile data
  onValue(ref(db, `users/${uid}`), (snapshot) => {
    const data = snapshot.val();
    if (!data) return;

    document.getElementById("welcomeText").innerText =
      "Welcome back, " + data.profile.name;

    document.getElementById("profileName").innerText =
      data.profile.name || "-";

    document.getElementById("profileEmail").innerText =
      data.profile.email || "-";

    document.getElementById("profileBackground").innerText =
      data.profile.background || "-";

    document.getElementById("profileLinkedin").innerHTML =
      data.profile.linkedin
        ? `<a href="${data.profile.linkedin}" target="_blank" style="color:#10b981;">View Profile</a>`
        : "-";

    document.getElementById("eventsCount").innerText =
      data.activity?.eventsAttended || 0;

    document.getElementById("downloadsCount").innerText =
      data.activity?.downloads || 0;

    document.getElementById("referralCode").innerText =
      data.referral?.code || "-";

    const level = data.membership?.level || "Free";
    document.getElementById("membershipLevel").innerText = level;

    const badge = document.getElementById("membershipBadge");
    badge.innerHTML =
      level === "Premium"
        ? `<span class="badge premium">Premium Member</span>`
        : `<span class="badge free">Free Member</span>`;
  });

  // Load notifications
  onValue(ref(db, `notifications/${uid}`), (snapshot) => {
    const container = document.getElementById("notificationsContainer");
    container.innerHTML = "";

    const notifications = snapshot.val();
    if (!notifications) {
      container.innerHTML = "<p>No notifications yet.</p>";
      return;
    }

    Object.values(notifications)
      .reverse()
      .forEach((n) => {
        const div = document.createElement("div");
        div.className = "notification";
        div.innerText = n.message;
        container.appendChild(div);
      });
  });

});

</script>

</body>
</html>
