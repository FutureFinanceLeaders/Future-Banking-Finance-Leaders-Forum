<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>FFL Dashboard</title>
<style>
body { 
  background: #0f172a; 
  color: white; 
  font-family: Arial; 
  padding: 20px;
}
.card {
  background: #1e293b;
  padding: 20px;
  border-radius: 10px;
  margin: 10px 0;
}
button {
  background: gold;
  color: black;
  padding: 10px 20px;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  margin: 5px;
}
</style>
</head>
<body>

<div id="app">
  <div id="loading" style="text-align: center; padding: 50px;">
    <h2>Loading...</h2>
  </div>

  <div id="content" style="display: none;">
    <div class="card">
      <h1 id="welcome">Welcome!</h1>
      <p>Email: <span id="email"></span></p>
      <p>User ID: <span id="uid"></span></p>
      <p>Status: <span id="status"></span></p>
    </div>

    <div class="card">
      <h3>Set Your Name</h3>
      <input type="text" id="firstName" placeholder="First name" style="padding: 10px; width: 200px;">
      <button onclick="saveName()">Save</button>
    </div>

    <button onclick="logout()">Logout</button>
  </div>
</div>

<script type="module">
import { auth, onAuthStateChanged, signOut, updateProfile } from "./firebase.js";

// Simple functions
window.saveName = async function() {
  const firstName = document.getElementById('firstName').value;
  if (!firstName) return alert('Enter a name');
  
  const user = auth.currentUser;
  if (!user) return alert('Not logged in');
  
  try {
    await updateProfile(user, { displayName: firstName });
    document.getElementById('welcome').innerHTML = `Welcome, ${firstName}! üëã`;
    alert('Name saved!');
  } catch (e) {
    // Even if Firebase update fails, save locally
    localStorage.setItem('ffl_name_' + user.uid, firstName);
    document.getElementById('welcome').innerHTML = `Welcome, ${firstName}! üëã`;
    alert('Name saved locally!');
  }
};

window.logout = async function() {
  await signOut(auth);
  window.location.href = 'login.html';
};

// Check auth
onAuthStateChanged(auth, (user) => {
  document.getElementById('loading').style.display = 'none';
  
  if (!user) {
    window.location.href = 'login.html';
    return;
  }
  
  document.getElementById('content').style.display = 'block';
  document.getElementById('email').innerText = user.email;
  document.getElementById('uid').innerText = user.uid;
  document.getElementById('status').innerText = user.emailVerified ? '‚úÖ Verified' : '‚ö†Ô∏è Not Verified';
  
  // Get name from either Firebase or localStorage
  const localName = localStorage.getItem('ffl_name_' + user.uid);
  const displayName = user.displayName || localName || 'Member';
  document.getElementById('welcome').innerHTML = `Welcome, ${displayName}! üëã`;
});
</script>

</body>
</html>